{
  "schema": "pi.golden_corpus.v1",
  "scenario": "json_mode_stdin_event_stream",
  "surface": "json_mode_stdin",
  "description": "JSON mode with stdin: verifies stdin content is sent and events are correct",
  "cli_args": [
    "--mode", "json",
    "--provider", "anthropic",
    "--model", "claude-sonnet-4-5",
    "--no-tools",
    "--no-extensions",
    "--no-skills",
    "--no-prompt-templates",
    "--no-themes",
    "--thinking", "off",
    "--system-prompt", "JSON stdin test."
  ],
  "stdin": "JSON stdin body\n",
  "env_overrides": {},
  "cassette": {
    "version": "1.0",
    "test_name": "golden_json_mode_stdin",
    "recorded_at": "2026-02-14T00:00:00.000Z",
    "interactions": [
      {
        "request": {
          "method": "POST",
          "url": "https://api.anthropic.com/v1/messages",
          "headers": [
            ["Content-Type", "application/json"],
            ["Accept", "text/event-stream"],
            ["X-API-Key", "[REDACTED]"],
            ["anthropic-version", "2023-06-01"],
            ["Content-Type", "application/json"]
          ],
          "body": {
            "model": "claude-sonnet-4-5",
            "messages": [
              {"role": "user", "content": [{"type": "text", "text": "JSON stdin body"}]}
            ],
            "system": "JSON stdin test.\nCurrent date and time: <TIMESTAMP>\nCurrent working directory: <CWD>",
            "max_tokens": 8192,
            "stream": true
          }
        },
        "response": {
          "status": 200,
          "headers": [
            ["Content-Type", "text/event-stream; charset=utf-8"]
          ],
          "body_chunks": [
            "event: message_start\ndata: {\"type\":\"message_start\",\"message\":{\"model\":\"claude-sonnet-4-5\",\"id\":\"msg_golden_json_stdin_001\",\"type\":\"message\",\"role\":\"assistant\",\"content\":[],\"stop_reason\":null,\"stop_sequence\":null,\"usage\":{\"input_tokens\":10,\"cache_creation_input_tokens\":0,\"cache_read_input_tokens\":0,\"output_tokens\":1,\"service_tier\":\"standard\"}}}\n\n",
            "event: content_block_start\ndata: {\"type\":\"content_block_start\",\"index\":0,\"content_block\":{\"type\":\"text\",\"text\":\"\"}}\n\n",
            "event: ping\ndata: {\"type\": \"ping\"}\n\n",
            "event: content_block_delta\ndata: {\"type\":\"content_block_delta\",\"index\":0,\"delta\":{\"type\":\"text_delta\",\"text\":\"stdin ok\"}}\n\n",
            "event: content_block_stop\ndata: {\"type\":\"content_block_stop\",\"index\":0}\n\n",
            "event: message_delta\ndata: {\"type\":\"message_delta\",\"delta\":{\"stop_reason\":\"end_turn\",\"stop_sequence\":null},\"usage\":{\"input_tokens\":10,\"cache_creation_input_tokens\":0,\"cache_read_input_tokens\":0,\"output_tokens\":4}}\n\n",
            "event: message_stop\ndata: {\"type\":\"message_stop\"}\n\n"
          ]
        }
      }
    ]
  },
  "expected": {
    "exit_code": 0,
    "stdout_contains": [],
    "stdout_not_contains": [],
    "stderr_not_contains": ["error", "panic"],
    "no_session_files": true,
    "json_event_sequence": [
      "session",
      "agent_start",
      "message_start",
      "message_end",
      "turn_start",
      "message_start",
      "message_update",
      "message_end",
      "turn_end",
      "agent_end"
    ],
    "json_session_header": true,
    "json_agent_start_has_session_id": true,
    "json_agent_end_has_messages": true
  }
}
